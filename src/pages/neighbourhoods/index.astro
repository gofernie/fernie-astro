---
import Site from "../../layouts/Site.astro";

const title = "Neighbourhoods — Fernie";
const description = "Browse Fernie neighbourhoods (data from Google Sheets).";

function slugify(s = "") {
  return String(s).toLowerCase().trim().replace(/&/g,"-and-").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");
}
async function fetchSheet(url) { const r = await fetch(url, { cache:"no-store" }); return r.json(); }

const url = import.meta.env.PUBLIC_SHEET_JSON;
let rows = [];
try {
  const raw = await fetchSheet(url);
  rows = raw.map(n => ({ ...n, _slug: (n.slug?.trim() || slugify(n.title)) }));
} catch {
  rows = [{ _slug:"", title:"Fallback", desc:"Sheet didn’t load.", img:"" }];
}
---
<Site title={title} description={description} active="neighbourhoods">
  <style>
    .grid{display:grid;gap:16px;grid-template-columns:1fr}
    @media (min-width:640px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:960px){.grid{grid-template-columns:repeat(3,1fr)}}
    .card{border:1px solid #eee;border-radius:14px;overflow:hidden;background:#fff;
          box-shadow:0 1px 2px rgba(0,0,0,.04);
          transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;}
    @media (hover:hover){.card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.08);border-color:#e6e6e6}}
    .card a{display:block;color:inherit;text-decoration:none}
    .card img{width:100%;height:auto;display:block;aspect-ratio:4/3;object-fit:cover}
    .inner{padding:12px}
    .inner h3{margin:6px 0;font-size:18px}
    .inner p{margin:0 0 8px;color:#444}
  </style>

  <h1>Neighbourhoods</h1>

  <section class="grid" aria-label="Neighbourhoods list">
    {rows.map(n => (
      <article class="card">
        <a href={n._slug ? `/neighbourhoods/${n._slug}` : "#"}>
          {n.img && <img src={n.img?.startsWith('http') ? n.img : '/images/' + n.img} alt={n.title} loading="eager" />}
          <div class="inner">
            <h3>{n.title}</h3>
            <p>{n.desc}</p>
          </div>
        </a>
      </article>
    ))}
  </section>
</Site>
