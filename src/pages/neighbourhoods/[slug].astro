---
import Site from "../../layouts/Site.astro";

/** Static pages built from your sheet */
function slugify(s = "") {
  return String(s).toLowerCase().trim().replace(/&/g,"-and-").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");
}
export async function getStaticPaths() {
  const url = import.meta.env.PUBLIC_SHEET_JSON;
  if (!url) return [];

  const res = await fetch(url);
  const data = await res.json();

  const items = data.map((n) => ({ ...n, _slug: (n.slug?.trim() || slugify(n.title || "")) }));
  const paths = items.filter(n => n._slug).map(n => ({
    params: { slug: n._slug },
    props: { item: { ...n, slug: n._slug } },
  }));

  console.log("[getStaticPaths] Built slugs:", paths.map(p => p.params.slug));
  return paths;
}

const { item } = Astro.props;
const pageTitle = `${item.title} — Fernie Neighbourhood`;
const description = item.desc || `About ${item.title}`;
const heroSrc = item.img?.startsWith("http") ? item.img : (item.img ? "/images/" + item.img : "");
---
<Site title={pageTitle} description={description} active="neighbourhoods">
  <!-- Full-bleed 40vh hero under the sticky nav -->
  <div slot="hero">
    {heroSrc && (
      <>
        <style>
          .hero40{width:100%;height:40vh;object-fit:cover;display:block;border-bottom:1px solid #eee}
        </style>
        <img class="hero40" src={heroSrc} alt={item.title} />
      </>
    )}
  </div>

  <style>
    .title{margin:0 0 8px;font-size:clamp(28px,4vw,42px)}
    .lede{color:#444;margin:0 0 16px}
    .content :where(h2,h3){margin-top:1.2em}
    .back{display:inline-block;margin:8px 0 16px;text-decoration:none;color:#111;border:1px solid #111;padding:8px 12px;border-radius:10px}
  </style>

  <a class="back" href="/neighbourhoods">← Back to neighbourhoods</a>
  <h1 class="title">{item.title}</h1>
  {item.desc && <p class="lede">{item.desc}</p>}

  <!-- Rich HTML from the sheet -->
  <section class="content" set:html={item.about}></section>
</Site>
